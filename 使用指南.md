# 🚀 拔罐小游戏关卡编辑器 - 快速使用指南

## ⚡ 5分钟快速上手

### 1️⃣ 启动编辑器
1. 打开Unity编辑器
2. 点击菜单栏 `Tools/Level Editor/一键配置`
3. 等待自动配置完成

### 2️⃣ 基本操作

#### 📝 添加内容
- **添加层级**：左侧面板 → "添加层级"按钮
- **添加形状**：工具栏 → "添加形状"按钮
  - 新形状会继承当前选中形状的类型
  - 如果没有选中形状，默认为圆形
- **添加球体**：选中形状 → 工具栏 → "添加球"按钮
  - 必须先选中一个形状才能添加球
  - 球会创建在选中的形状内部

#### 🎮 编辑操作
- **选择对象**：点击形状或球体进行选择（选中后会高亮显示）
- **拖拽移动**：选中对象后拖拽移动
- **旋转形状**：选中形状后使用右侧旋转滑块
- **调整位置**：选中对象后使用右侧X/Y位置滑块
- **更改形状类型**：
  1. 先点击选中一个形状（形状会变成黄色高亮）
  2. 然后点击右侧的形状类型按钮（圆形/矩形/三角形/菱形）
  3. 形状会立即变成选中的类型

#### 📊 导出数据
- 点击右侧面板 → "导出JSON"按钮
- 数据自动复制到剪贴板
- 在Console窗口查看完整数据

## 🎯 界面说明

### 左侧面板 - 层级管理
```
┌─────────────────┐
│ 层级列表        │
│ ├ 默认层级      │
│ ├ 层级2         │
│ └ 层级3         │
│                 │
│ [添加层级]      │
│ [删除层级]      │
└─────────────────┘
```

### 中间区域 - 编辑区
```
┌─────────────────────────────────┐
│ [添加形状] [添加球] [背景] [预览]│ ← 工具栏
├─────────────────────────────────┤
│                                 │
│        ⭕ 形状1                 │
│         ● 球体                  │
│                                 │
│     ⬜ 形状2                    │
│                                 │
└─────────────────────────────────┘
```

### 右侧面板 - 属性编辑
```
┌─────────────────┐
│ 属性面板        │
│                 │
│ 名称: [输入框]  │
│ X位置: [滑块]   │
│ Y位置: [滑块]   │
│ 旋转: [滑块]    │
│ 形状类型:       │
│ [圆形]          │
│ [矩形]          │
│ [三角形]        │
│ [菱形]          │
│                 │
│ [导出JSON]      │
└─────────────────┘
```

## 🎨 自定义配置

### 📝 配置编辑器
- **打开配置**：`Tools/Level Editor/配置编辑器`
- **自定义形状类型**：添加/删除形状，设置名称和图片
- **自定义球类型**：添加/删除球，设置名称、颜色和图片
- **自定义背景**：添加/删除背景，设置颜色或图片
- **重置配置**：恢复默认配置
- **刷新编辑器**：应用新配置到编辑器

### 📝 配置预览
- **编辑器预览**：`Tools/Level Editor/预览配置` - 在编辑器中查看所有配置
- **运行时预览**：工具栏 → "预览"按钮 - 在游戏运行时查看配置
- **刷新功能**：预览界面中的"刷新"按钮 - 实时更新显示新添加的图形和球
- **滚动浏览**：当图形和球过多时，可以上下滚动查看所有内容
- **生成预制体**：`Tools/Level Editor/生成预览预制体` - 创建预览UI预制体
- **配置调试**：`Tools/Level Editor/配置调试` - 检查配置加载状态和调试问题
- **配置使用测试**：`Tools/Level Editor/配置使用测试` - 验证配置中的图形和球是否正确使用
- **修复图片引用**：`Tools/Level Editor/修复图片引用` - 查找和修复配置中丢失的图片引用
- **实时更新测试**：`Tools/Level Editor/实时更新测试` - 测试配置变更时的实时UI更新功能
- **编译测试**：`Tools/Level Editor/编译测试` - 验证所有组件是否正常编译和工作
- **事件系统测试**：`Tools/Level Editor/事件系统测试` - 测试配置变更事件系统是否正常工作
- **工厂测试**：`Tools/Level Editor/工厂测试` - 专门测试UI更新器工厂的功能
- **工厂系统**：使用 `UIUpdaterFactory` 创建UI更新器，通过反射访问Editor类
- **Editor创建器**：使用 `UIUpdaterCreator` 在Editor中直接创建UI更新器，避免反射复杂性

### 🎨 默认形状类型

| 形状 | 说明 | 特点 |
|------|------|------|
| ⭕ 圆形 | 基础圆形 | 适合放置球体 |
| ⬜ 矩形 | 方形 | 稳定支撑 |
| 🔺 三角形 | 三角形 | 动态布局 |
| 💎 菱形 | 菱形 | 装饰性 |

### 🎨 默认球类型

| 球类型 | 颜色 | 说明 |
|--------|------|------|
| 🔴 红球 | 红色 | 基础球体 |
| 🔵 蓝球 | 蓝色 | 基础球体 |
| 🟢 绿球 | 绿色 | 基础球体 |

### 🎨 默认背景类型

| 背景类型 | 说明 | 特点 |
|----------|------|------|
| 🟦 默认背景 | 白色背景 | 简洁清晰 |
| 🔲 网格背景 | 浅灰色背景 | 便于对齐 |
| ⚫ 深色背景 | 深灰色背景 | 对比强烈 |

## 📋 操作技巧

### 💡 高效编辑
1. **批量操作**：先添加多个形状，再逐个编辑
2. **精确定位**：使用右侧滑块精确调整位置
3. **快速切换**：点击层级名称快速切换编辑层级

### 🎯 形状类型切换
1. **选中形状**：点击形状使其高亮显示（黄色）
2. **选择类型**：点击右侧形状类型按钮（圆形/矩形/三角形/菱形）
3. **立即生效**：形状会立即变成选中的类型
4. **新建形状**：新创建的形状会使用当前选中的类型

### 🎯 球类型切换
1. **选中球体**：点击球体使其高亮显示（黄色）
2. **选择类型**：点击右侧球类型按钮（红球/蓝球/绿球）
3. **立即生效**：球会立即变成选中的类型和颜色
4. **新建球体**：新创建的球会使用当前选中的类型

### 🎯 背景切换
1. **点击背景按钮**：工具栏 → "背景"按钮
2. **循环切换**：每次点击切换到下一个背景
3. **配置背景**：在配置编辑器中自定义背景颜色和图片

### 🎯 配置预览
1. **点击预览按钮**：工具栏 → "预览"按钮
2. **查看所有配置**：显示所有形状、球和背景的预览
3. **编辑器预览**：`Tools/Level Editor/预览配置` 在编辑器中查看
4. **生成预制体**：`Tools/Level Editor/生成预览预制体` 创建预览UI

#### 💾 数据管理
- **导出关卡**：右侧面板 → "导出JSON"按钮
  - 包含所有层级（包括默认层级）
  - 保存到 `Assets/SavedLevels/` 目录
  - 文件名格式：`Level_yyyyMMdd_HHmmss.json`
  - 同时复制到剪贴板
- **导入关卡**：右侧面板 → "导入关卡"按钮
  - 自动加载最新的关卡文件
  - 从 `Assets/SavedLevels/` 目录读取

### 🎯 最佳实践
1. **层级规划**：使用不同层级组织关卡元素
2. **命名规范**：给形状和球体起有意义的名字
3. **数据备份**：定期导出JSON数据作为备份

## 🐛 常见问题

### ❓ 问题：UI没有显示
**解决**：检查Console窗口错误信息，重新运行一键配置

### ❓ 问题：拖拽不响应
**解决**：确保EventSystem存在，检查GraphicRaycaster

### ❓ 问题：球体无法拖拽
**解决**：球体只能在所属形状内移动，这是正常限制

### ❓ 问题：导出失败
**解决**：检查Console窗口，确保关卡数据正确初始化

### ❓ 问题：形状类型无法切换
**解决**：
1. 确保先点击选中形状（形状会变成黄色高亮）
2. 然后点击右侧的形状类型按钮
3. 查看Console窗口的调试信息

### ❓ 问题：没有配置的形状或球类型
**解决**：
1. 打开 `Tools/Level Editor/配置编辑器`
2. 在"形状类型配置"中添加形状类型
3. 在"球类型配置"中添加球类型
4. 点击"保存配置"按钮
5. 重新尝试创建形状或球

## 📊 数据格式示例

```json
{
  "levelName": "我的关卡",
  "layers": [
    {
      "layerName": "主层级",
      "shapes": [
        {
          "shapeType": "圆形",
          "position": {"x": 100, "y": 50},
          "rotation": 45.0,
          "balls": [
            {
              "ballType": "红球",
              "position": {"x": 10, "y": 5}
            }
          ]
        }
      ]
    }
  ]
}
```

## 🔧 高级功能

### 🔄 实时更新功能

- **配置变更检测**：当配置发生变更时，系统会自动检测并更新UI
- **UI同步更新**：形状类型按钮、球类型按钮、背景等UI组件会实时同步更新
- **预览UI刷新**：配置预览UI会自动刷新显示最新的配置内容
- **事件驱动更新**：使用事件系统确保配置变更时立即反映在UI中
- **自动索引调整**：当配置项被删除时，自动调整当前选中的索引
- **内存管理**：自动清理和重新创建UI组件，避免内存泄漏

### 自定义扩展
- 修改`ShapeController.cs`添加新形状类型
- 修改`BallController.cs`添加新球体样式
- 编辑`LevelEditorUIBuilder.cs`调整UI布局

### 脚本API
```csharp
// 获取当前关卡数据
LevelData level = levelEditor.currentLevel;

// 添加新形状
ShapeData newShape = new ShapeData("圆形", Vector2.zero, 0f);
levelEditor.currentLayer.shapes.Add(newShape);

// 导出JSON
string json = LevelDataExporter.SaveToJson(level);
```

---

**🎉 现在你可以开始创建精彩的关卡了！**

如有问题，请查看完整文档或提交Issue。 